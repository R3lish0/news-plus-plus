---
import { getCollection } from "astro:content";
import Layout from "./Layout.astro";
import Card from "../components/Card.astro";
import SiteHeader from "../components/SiteHeader.astro";

interface Props {
    title: string;
    pageTitle: string;
    img: string;
    currentSlug?: string;
}

const { title, pageTitle, img, currentSlug } = Astro.props;

// Get all articles for the sidebar
const allArticles = await getCollection("article");

allArticles.sort((a, b) => {
  const dateA = new Date(a.data.date).getTime();
  const dateB = new Date(b.data.date).getTime();
  return dateB - dateA;
});
---

<Layout title={title} img={img}>
    <div class="layout-container">
        <div class="layout-grid">
            <aside class="layout-sidebar">
                <SiteHeader variant="desktop-sticky" />
                <nav class="sidebar-content">
                    <h2 class="content-heading content-heading--mobile">Latest Articles</h2>
                    <ul class="component-card-grid">
                        {
                            allArticles.filter(article => article.slug !== 'about').map((article) => (
                                <Card
                                    href={`${import.meta.env.BASE_URL}posts/${article.slug}`}
                                    title={article.data.title}
                                    img={article.data.img}
                                    author={article.data.author}
                                    isActive={currentSlug ? article.slug === currentSlug : false}
                                />
                            ))
                        }
                    </ul>
                </nav>
            </aside>
            
            <main class="layout-primary-content">
                <slot />
            </main>
        </div>
    </div>
</Layout>

<style>
    @import '../styles/layout.css';
</style>