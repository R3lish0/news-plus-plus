---
import { getCollection } from "astro:content";
import Layout from "./Layout.astro";
import Card from "../components/Card.astro";

interface Props {
    title: string;
    pageTitle: string;
    img: string;
    currentSlug?: string;
}

const { title, pageTitle, img, currentSlug } = Astro.props;

// Get all articles for the sidebar
const allArticles = await getCollection("article");

allArticles.sort((a, b) => {
  const dateA = new Date(a.data.date).getTime();
  const dateB = new Date(b.data.date).getTime();
  return dateB - dateA;
});
---

<Layout title={title} img={img}>
    <main>
        <div class="headers-layout">
            <h2 class="section-heading">{pageTitle}</h2>
            <h2 class="section-heading articles-header-desktop">Latest Articles</h2>
        </div>
        <div class="content-layout">
            <div class="press-section">
                <slot />
            </div>
            <div class="articles-section">
                <h2 class="section-heading articles-header-mobile">Latest Articles</h2>
                <ul class="card-grid">
                    {
                        allArticles.filter(article => article.slug !== 'about').map((article) => (
                            <Card
                                href={`${import.meta.env.BASE_URL}posts/${article.slug}`}
                                title={article.data.title}
                                img={article.data.img}
                                author={article.data.author}
                                isActive={currentSlug ? article.slug === currentSlug : false}
                            />
                        ))
                    }
                </ul>
                <div class="integrated-brand">
                    <div class="brand-section">
                        <a class="brand-link" href={`${import.meta.env.BASE_URL}`}>news++</a>
                        <span class="brand-divider">â€¢</span>
                        <span class="brand-by">by</span>
                    </div>
                    <div class="author-links">
                        <a class="author-link" href="https://github.com/R3lish0">
                            <img class="author-avatar" alt="R3lish0" src="https://avatars.githubusercontent.com/u/43016438?v=4" />
                            <span class="author-name">R3lish0</span>
                        </a>
                        <a class="author-link" href="https://github.com/stickyfingies">
                            <img class="author-avatar" alt="stickyfingies" src="https://avatars.githubusercontent.com/u/11356884?v=4" />
                            <span class="author-name">stickyfingies</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>
</Layout>

<style>
    @import '../styles/layout.css';
</style>